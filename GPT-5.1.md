# От Kubespray к единой платформе: эволюция Kubernetes, Cluster API и Crossplane между облаком и on-premise

## Вступление

Этот доклад — попытка прожить вместе со мной путь обычного инженера за последние пять лет.
Путь от человека, которому говорят: *«Ты слишком мал для BGP»*, до инженера, который спустя годы задаёт сетевые стратегии, спорит с сетевыми командами и ведёт архитектурные решения в Enterprise-масштабе.

Это история про развитие платформ, технологий, процессов, DevOps-культуры — и про то, как бизнес влиял на каждое решение.

---

## 1. Истоки: когда Kubernetes ещё пугал

Пять лет назад Kubernetes только набирал обороты.
Контейнеры казались магией, orchestration — чем-то нестабильным, а реальная эксплуатация — чистым экспериментом.

Тем не менее, мы ставили Kubernetes на «голое железо», собирали кластеры руками, пытались делать собственный IaaS под Kubernetes. GitOps ещё не существовал как термин, но CI у всех уже был — и все пытались построить свои CD-процессы.

Мы искали лучшие практики, которых тогда ещё не было.

---

## 2. Kubespray: первая попытка стандартизации

Kubespray стал первой попыткой собрать что-то похожее на платформу.
Он облегчил старт, но принёс и свои ограничения:

- отсутствие жизненного цикла кластеров,
- отсутствие стабильной апгрейд-стратегии,
- проблемы сетевых плагинов,
- боль изменений конфигурации,
- риск захлебнуться в Ansible-хаосе.

Kubespray был хорош для начала, но плохо масштабировался.

---

## 3. Terraform, Helm и поиск Declarative

Кто-то пытался построить платформу на Terraform.
Спойлер: никто не довёл до конца.

Helm быстро превратился в слой магии, который приходилось чинить.

Постепенно стало понятно: нам нужен **декларативный подход**.
Мы начали отказываться от Helm и Ansible в пользу ресурсов, которые описываются как часть Kubernetes.

---

## 4. Иммутабельные системы: отказ от классических Linux-дистрибутивов

Следующий логичный шаг — **immutable-системы**.

Мы пробовали Talos Linux. Он выглядел идеально, но в реальности мы столкнулись с:

- проблемами отладки,
- ограничениями `teshell`,
- невозможностью полноценного доступа на хост,
- несовместимостью с необходимыми контроллерами.

Talos был красив теоретически, но инфраструктуре нужны были инструменты, которые он ограничивал.

---

## 5. Cluster API: рождение настоящих платформ

Cluster API стал поворотной точкой.
Наконец появилось то, чего не хватало Kubernetes:

- машиностроение,
- управление жизненным циклом,
- декларативность,
- контроль версий,
- предсказуемость и повторяемость.

С появлением Cluster API платформа стала платформой, а не хаосом из скриптов.

---

## 6. Crossplane и композитные ресурсы: Infrastructure as APIs

Crossplane стал следующим этапом:
работа с инфраструктурой через **Kubernetes API**, а не через внешний инструмент.

Мы смогли:

- заменить Terraform в критически важных местах,
- управлять сетями, DNS, клауд-ресурсами,
- создавать композиции ресурсов под бизнес-процессы,
- описывать инфраструктуру декларативно и версионируемо.

Crossplane позволил делать платформу изнутри, а не снаружи.

---

## 7. GitOps: дисциплина и компромиссы

Внедрение GitOps потребовало боли и компромиссов:

- как сохранить скорость разработки?
- как сделать тестирование на стейджинге безболезненным?
- как удержать железный контроль изменений на проде?

GitOps — это не про ArgoCD или Flux.
Это про дисциплину, прозрачность и отказ от хаотичных ручных действий.

---

## 8. Облака, ФПХ и деоблакизация

Заходить в облака было тяжело из-за ограничений и внешних факторов.
Но ещё тяжелее — **уходить из облаков**, когда бизнес требует резать косты.

Бизнес говорит:

> «Съезжаем с облаков. Бюджет на железо безлимитный.»

Но при этом:

- сеть как сервис никто не даст,
- IaaS как сервис никто не даст,
- придётся строить всё самим: сеть, безопасность, платформу.

Деоблакизация — модная тема, но за ней стоит простая истина:
**инженерия подстраивается под бизнес. Всегда.**

---

## 9. Операционные издержки: скрытая цена платформы

Бизнес любит говорить «делайте быстрее».
Но ускорение приводит к росту:

- operational cost,
- нагрузки на команду,
- сложности эксплуатации,
- количества инцидентов,
- стоимости поддержки.

Эти издержки редко попадают в презентации, но они формируют судьбу всей платформы.

---

## 10. Итог: путь от хаоса к платформенному мышлению

За пять лет мы прошли путь:

- от Kubespray → к Cluster API → к Crossplane,
- от Ansible → к декларативности,
- от классических Linux → к иммутабельным,
- от CI-хаоса → к GitOps,
- от «всё в облако» → к гибридным стратегиям,
- от инженеров-исполнителей → к инженерам-архитекторам.

Главный вывод:

> **Платформа — это не набор тулов. Платформа — это культура, процессы и инженерное мышление.**
