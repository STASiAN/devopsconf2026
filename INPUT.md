# От Kubespray к единой платформе: как Kubernetes, Cluster API и Crossplane связали облако и on-premise в цельную экосистему

## Вступление

Я хочу рассказать о том, как давным-давно, когда только появился Kubernetes, и все еще боялись Docker-контейнеров, мы все равно ставили Kubernetes на железо. Прошли через Kubespray, пытались делать IaaS под Kubernetes. Какие инструменты мы использовали, что мы делали. Не было еще придумано слова GitOps, но уже были CI-системы. Какие CD-системы мы строили. Если поговорить про CI, то оно плюс-минус одинаковое у всех. Но мы пришли к достаточно качественному Continuous Delivery. Какой путь мы прошли. Какие беды мы пережили. Зачем мы это делали, что требовал бизнес.

Один простой момент: когда твоя система становится слишком сложной, рабочие люди перестают ей пользоваться, потому что порог входа огромный. Как мы при помощи Crossplane и композитных ресурсов упростили инфраструктуру так, что она стала проще любого Terraform.

Давайте поиграем в секту: кто любит Terraform, а кто не любит?

- Готовы ли вы изменить HCL на YAML?
- Готовы ли отказаться от Ansible?
- Готовы ли вы заменить рутинные процессы настоящей автоматизацией?
- Azure Functions? Serverless? Infrastructure as Code?

Все то, о чем вы мечтали и хотели попробовать, но до сих пор не попробовали.

## Мой путь в эволюции платформ

Я хочу рассказать вкратце свой путь, который я прошел за последние пять лет, через N-ную версию идеальной, по мнению бывалого DevOps-инженера, платформы. Как шел мой путь как инженера вместе с эволюцией платформ, какими сценариями мы пренебрегали и какие реализовывали. Все же знают эти диаграммы Венна, где пересекаются SRE и DevOps. Как произошла DevOps-трансформация и произошло ли взаимодействие DevOps-отделов с другими командами? Можно поговорить про процессы, но хотелось бы больше поговорить про технологии.

## Immutable Infrastructure и Talos Linux

Как мы отказались от классических дистрибутивов Linux в пользу Immutable Systems? Почему мы решили заехать на Talos Linux и какие проблемы он нам доставил? С точки зрения операционной поддержки: сможешь ли ты с SSH зайти на хост или нет?

## Эволюция инструментов

В основном будет рассказано о том, как происходила эволюция систем от Kubespray. В дальнейшем кто-то пытался сделать что-то на Terraform — и как это получилось.

- Как мы отказались от Helm?
- Как мы пошли в сторону декларативного описания ресурсов и версионирования при помощи Custom Resources Kubernetes с минимальными усилиями?
- Сможет ли один DevOps-инженер поддерживать развитую платформу?
- Смогут ли четверо DevOps за год сделать ее незабываемой?

## GitOps и компромиссы

Что нам стоило внедрение GitOps, и на какие компромиссы мы решили пойти?

- Удобство разработки
- Безболезненное тестирование на staging-окружении
- Железная система контроля доступа (ACL) на production-окружении
